{% extends "base.html" %}

{% block title %}Dashboard - AI Trading Assistant{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Page Header -->
    <div class="page-header">
        <h1>üìä Dashboard</h1>
        <p>Welcome back, <strong>{{ user.username }}</strong>! Here's your market overview</p>
    </div>
    
    <!-- Fear & Greed Index - Top Position -->
    <div class="card" style="margin-bottom: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
        <div class="card-header" style="border-bottom: 1px solid rgba(255,255,255,0.2);">
            <h2 style="color: white;">üò± Fear & Greed Index</h2>
            <small style="color: rgba(255,255,255,0.9);">Current market sentiment</small>
        </div>
        <div class="card-body">
            <div id="fearGreedContent" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; align-items: center;">
                <!-- Loading state -->
                <div class="loading-spinner" style="text-align: center; padding: 2rem; grid-column: 1 / -1;">
                    <div class="spinner" style="border-color: rgba(255,255,255,0.3); border-top-color: white;"></div>
                    <p style="color: white; margin-top: 1rem;">Loading Fear & Greed Index...</p>
                </div>
            </div>
            
            <!-- Info Box -->
            <div style="margin-top: 2rem; padding: 1rem; background: rgba(255,255,255,0.15); border-radius: 8px;">
                <h4 style="margin: 0 0 0.5rem 0; font-size: 0.95rem; color: white;">üí° How to interpret:</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.75rem; font-size: 0.85rem; line-height: 1.5;">
                    <div><strong>0-24</strong>: Extreme Fear üò∞ - Buying opportunity</div>
                    <div><strong>25-49</strong>: Fear üòü - Market cautious</div>
                    <div><strong>50-74</strong>: Greed üòä - Market bullish</div>
                    <div><strong>75-100</strong>: Extreme Greed ü§ë - Consider selling</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Market Overview Section -->
    <div class="card market-overview-card" style="margin-bottom: 2rem;">
        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h2>üåê Market Overview</h2>
                <p style="margin: 0.25rem 0 0 0; font-size: 0.875rem; color: #64748b;">
                    Top 20 cryptocurrencies ‚Ä¢ Live from CoinMarketCap ‚Ä¢ Auto-updates every 30 seconds
                </p>
            </div>
            <div style="display: flex; gap: 0.5rem; align-items: center;">
                <span id="marketLastUpdate" style="font-size: 0.75rem; color: #94a3b8;">
                    Loading...
                </span>
                <button id="refreshMarketBtn" class="btn btn-secondary btn-sm">
                    üîÑ Refresh
                </button>
            </div>
        </div>
        <div class="card-body">
            <!-- Loading State -->
            <div id="marketLoading" class="loading-spinner" style="display: block; padding: 2rem; text-align: center;">
                <div class="spinner"></div>
                <p style="margin-top: 1rem;">Loading market data...</p>
            </div>
            
            <!-- Market Table -->
            <div id="marketTableContainer" style="display: none; overflow-x: auto;">
                <table class="market-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Coin</th>
                            <th>Price</th>
                            <th>1h %</th>
                            <th>24h %</th>
                            <th>7d %</th>
                            <th>Market Cap</th>
                            <th>Volume (24h)</th>
                        </tr>
                    </thead>
                    <tbody id="marketTableBody">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- Error State -->
            <div id="marketError" style="display: none; padding: 2rem; text-align: center; color: #ef4444;">
                <p style="margin: 0;">‚ùå Failed to load market data</p>
                <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem;" id="marketErrorMsg"></p>
            </div>
        </div>
    </div>
    
    <!-- Main Content Grid -->
    <div class="main-grid">
        <!-- Left Column: Indicators -->
        <div class="left-column">
            <!-- Technical Indicators Section -->
            <div class="card indicators-card">
                <div class="card-header">
                    <h2>üìä Technical Indicators</h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <select id="symbolSelector" class="select-input" onchange="onSymbolChange()" style="margin-right: 0.5rem;">
                            <option value="BTCUSDT" {% if active_symbol == 'BTCUSDT' %}selected{% endif %}>Bitcoin (BTC)</option>
                            <option value="ETHUSDT" {% if active_symbol == 'ETHUSDT' %}selected{% endif %}>Ethereum (ETH)</option>
                            <option value="BNBUSDT" {% if active_symbol == 'BNBUSDT' %}selected{% endif %}>Binance Coin (BNB)</option>
                            <option value="SOLUSDT" {% if active_symbol == 'SOLUSDT' %}selected{% endif %}>Solana (SOL)</option>
                            <option value="ADAUSDT" {% if active_symbol == 'ADAUSDT' %}selected{% endif %}>Cardano (ADA)</option>
                        </select>
                        <button id="refreshIndicatorsBtn" class="btn btn-secondary btn-sm">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Data Freshness Info -->
                    <div id="indicatorsDataInfo" style="display: none; background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 6px; padding: 0.75rem; margin-bottom: 1rem; font-size: 0.875rem;">
                        <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem;">
                            <div>
                                <strong>Data Updated:</strong> <span id="indicatorsLastUpdate">--</span>
                            </div>
                            <div>
                                <strong>Source:</strong> <span style="color: #0891b2;">Binance via CCXT</span>
                            </div>
                            <div>
                                <strong>Candles:</strong> <span id="indicatorsCandles">250</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="indicatorsLoading" class="loading-spinner" style="display: block; padding: 2rem;">
                        <div class="spinner"></div>
                        <p>Loading indicators...</p>
                    </div>
                    
                    <div id="indicatorsContent" style="display: none;">
                        <!-- Moving Averages -->
                        <div class="indicators-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="indicator-item">
                                <div class="indicator-label">MA 9</div>
                                <div class="indicator-value" id="ma9Value">-</div>
                                <small>Scalping trend</small>
                            </div>
                            
                            <div class="indicator-item">
                                <div class="indicator-label">MA 20</div>
                                <div class="indicator-value" id="ma20Value">-</div>
                                <small>Short-term trend</small>
                            </div>
                            
                            <div class="indicator-item">
                                <div class="indicator-label">MA 50</div>
                                <div class="indicator-value" id="ma50Value">-</div>
                                <small>Medium-term trend</small>
                            </div>
                            
                            <div class="indicator-item">
                                <div class="indicator-label">MA 200</div>
                                <div class="indicator-value" id="ma200Value">-</div>
                                <small>Major trend</small>
                            </div>
                            
                            <div class="indicator-item">
                                <div class="indicator-label">RSI 14</div>
                                <div class="indicator-value" id="rsi14Value">-</div>
                                <small id="rsiSignal">-</small>
                            </div>
                            
                            <div class="indicator-item">
                                <div class="indicator-label">Current Price</div>
                                <div class="indicator-value" id="currentPriceValue">-</div>
                                <small id="trendSignal">-</small>
                            </div>
                        </div>
                        
                        <!-- MA Trading Signals -->
                        <div id="maSignalsBox" style="margin-top: 1.5rem; padding: 1.25rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">
                            <h3 style="margin: 0 0 1rem 0; font-size: 1.25rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span>‚ö°</span>
                                <span>MA Trading Signals</span>
                            </h3>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div style="background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 8px;">
                                    <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem;">Overall Signal</div>
                                    <div id="maOverallSignal" style="font-size: 1.75rem; font-weight: bold;">--</div>
                                </div>
                                
                                <div style="background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 8px;">
                                    <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem;">Confidence</div>
                                    <div id="maConfidence" style="font-size: 1.75rem; font-weight: bold;">--</div>
                                </div>
                                
                                <div style="background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 8px;">
                                    <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem;">Long-term</div>
                                    <div id="maTrendLabel" style="font-size: 1.1rem; font-weight: 600;">--</div>
                                </div>
                                
                                <div style="background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 8px;">
                                    <div style="font-size: 0.875rem; opacity: 0.9; margin-bottom: 0.5rem;">Short-term</div>
                                    <div id="maShortTerm" style="font-size: 1.1rem; font-weight: 600;">--</div>
                                </div>
                            </div>
                            
                            <div id="emaCrossInfo" style="margin-top: 1rem; padding: 0.75rem; background: rgba(255,255,255,0.2); border-radius: 8px; font-size: 0.95rem; font-weight: 500; display: none;">
                                --
                            </div>
                            
                            <div id="maExplanation" style="margin-top: 1rem; padding: 0.75rem; background: rgba(255,255,255,0.1); border-radius: 8px; font-size: 0.875rem; line-height: 1.6;">
                                --
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Column: AI Prediction -->
        <div class="right-column">
            <!-- AI Prediction Card -->
            <div class="card prediction-card">
                <div class="card-header">
                    <h2>ü§ñ AI Price Prediction</h2>
                    <button id="refreshPredictionBtn" class="btn btn-secondary btn-sm">
                        üîÑ Get Prediction
                    </button>
                </div>
                <div class="card-body">
                    <div id="predictionDataInfo" style="display: none; background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 6px; padding: 0.75rem; margin-bottom: 1rem; font-size: 0.875rem;">
                        <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem;">
                            <div>
                                <strong>Last Price:</strong> <span id="predictionLastPrice">--</span>
                            </div>
                            <div>
                                <strong>Data Updated:</strong> <span id="predictionLastUpdate">--</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="predictionContent">
                        {% if prediction %}
                        <div class="prediction-result">
                            <div class="prediction-direction {{ 'up' if prediction.direction == 'UP' else 'down' }}">
                                {{ prediction.direction }}
                            </div>
                            <div class="prediction-confidence">
                                <div class="confidence-label">Confidence</div>
                                <div class="confidence-value">{{ prediction.confidence_pct }}%</div>
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: {{ prediction.confidence_pct }}%"></div>
                                </div>
                            </div>
                            <div class="prediction-meta">
                                <small>Generated: {{ prediction.timestamp }}</small>
                            </div>
                        </div>
                        {% else %}
                        <div class="prediction-empty">
                            <p style="text-align: center; color: #64748b;">No prediction available yet.</p>
                            <p style="text-align: center; color: #64748b; font-size: 0.875rem;">Click "Get Prediction" to generate AI forecast.</p>
                        </div>
                        {% endif %}
                    </div>
                    <div id="predictionLoading" class="loading-spinner" style="display: none;">
                        <div class="spinner"></div>
                        <p>Generating prediction...</p>
                    </div>
                    
                    <!-- Link to Advanced Prediction -->
                    <div style="margin-top: 1.5rem; padding: 1rem; background: #f8fafc; border-radius: 8px; text-align: center;">
                        <p style="margin: 0 0 0.75rem 0; font-size: 0.875rem; color: #64748b;">
                            Want more detailed analysis with AI models?
                        </p>
                        <a href="/advanced_prediction" class="btn btn-primary">
                            üîÆ Go to Advanced Prediction
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions Card -->
            <div class="card" style="margin-top: 1.5rem;">
                <div class="card-header">
                    <h2>‚ö° Quick Actions</h2>
                </div>
                <div class="card-body">
                    <div style="display: grid; gap: 0.75rem;">
                        <a href="/trade" class="btn btn-primary btn-block">
                            üíπ Start Trading
                        </a>
                        <a href="/portfolio" class="btn btn-secondary btn-block">
                            üíº View Portfolio
                        </a>
                        <a href="/exchanges" class="btn btn-secondary btn-block">
                            üîó Manage Exchanges
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Link JavaScript -->
<script src="{{ url_for('static', filename='js/market_overview.js') }}"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}

